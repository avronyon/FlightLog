{% extends "base.html" %}

{% block content %}

<body>
	{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
	<div class="container">
	<form action="add_sorties" method="post">
		{% csrf_token %}
		<div class="row">
			<input id="date" name="date" min="2016-02-16" max="2020-01-01" type="date">
		</div>
		<div id='sorties' class="row">
		</div>
		<div id = 'add' class="row">
			<input type="button" class="button" value="" onClick="addSortie()">
		<div>
		<div id = "footer" class="row" style= "position:bottom">
        	<input id = 'submit' type="submit" value="SUBMIT">
        </div>
	</form>
	<div>
</body>

<script>

	var sortie_counter = 1;
	var FLIGHT_OPTIONS = ["night", "recon", "shoham",];
	var GROUND_OPTIONS = ["sim","sim_winter","malam","yarpa",];
	addSortie();
	
	function createCheckboxElement(name, text, checked , hidden = false) {
		var label = document.createElement('LABEL');
		label.setAttribute("class","btn btn-warning");
		label.setAttribute("for",name);
		var checkBox = document.createElement('INPUT');
		checkBox.setAttribute('type','checkbox');
		checkBox.setAttribute('name',name);
		checkBox.setAttribute('id',name);
		checkBox.setAttribute('display','none');
		checkBox.setAttribute('autocomplete',"off");
		if(checked){
			checkBox.checked = true;
		}
		if(hidden){
			label.setAttribute('style','display:none;')
		}
		label.textContent = text;
		label.appendChild(checkBox);
		return label.outerHTML;
	}

	function createOptions(options,j){
		var innerHTML = '<div class="btn-group" data-toggle="buttons"> <legend>Sortie ' +j + '</legend>';
        var i;
        innerHTML += createCheckboxElement("mission"+j,'', true , true);
        for(i = 0 ; i < options.length ; i++)
        {
            innerHTML += createCheckboxElement("mission"+j+options[i],options[i], false);
        }
        if(options == FLIGHT_OPTIONS){
        	innerHTML += '<br><label for="air">Switch to Ground Activity</label><input type="checkbox" name="air" onClick="ToggleGndAir(this,'+j+')">';
        }
        else{
        	innerHTML += '<br><label for="gnd">Switch to Flight</label><input type="checkbox" name="gnd" onClick="ToggleGndAir(this,'+j+')">';
        }
        innerHTML += '</div>';
        var checkboxFragment = document.createElement('div');
		checkboxFragment.innerHTML = innerHTML;
		return checkboxFragment;
    }
    
    function addSortie(){
	  var newdiv = document.createElement('div');
	  innerHTML = createOptions(FLIGHT_OPTIONS,sortie_counter).innerHTML;
	  newdiv.innerHTML = innerHTML;
	  var sorteisDiv = document.getElementById('sorties');
	  sorteisDiv.appendChild(newdiv);
	  sortie_counter++;
     }
     
     function ToggleGndAir(el,j){
     	var oldFieldset = el.parentNode.parentNode;
     	console.log(oldFieldset.innerHTML);
     	var newFiedset = document.createElement('div');
     	if(el.name == 'air'){ 	
     		newFiedset.innerHTML = createOptions(GROUND_OPTIONS,j).innerHTML;
     	}
     	else{
     		newFiedset.innerHTML = createOptions(FLIGHT_OPTIONS,j).innerHTML;
     	}
     	console.log(newFiedset.innerHTML);
     	oldFieldset.insertBefore(newFiedset,el.parentNode);
     	el.parentNode.parentNode.removeChild(el.parentNode);
        console.log(oldFieldset.innerHTML);   	
     }
</script>

{% endblock %}
